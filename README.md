# Mrs Marper

## Current project goals:
* Change folder structure so that we have a project folder, that contains username folders, that in turn contains project folders.
* Each project folder should contain the following source files:
  * index.md
  * theme.css
  * fonts.css
  * font folder
  * image folder
* Update the command **npm run make** / read CLI parameter in make/_index.js so that can choose a project folder to run through Mrs Marper. 'npm run make dirname'.
* Create online frontend/backend for creating, viewing and editing projects, running the npm run make command as a worker/sub-process.
* Create interactive preview for frontend.
* Future ideas: Automatic flow of text into new slides / "book setting".

**Note:** This README.md file can (and should) be auto-generated by running **npm run make-doc**. 

## What do we have here?
A slide-deck built with [MARP](https://marp.app)+ **Mrs Marper**.

The **Mrs Marper** source code is located in the folder [make](make).

**Mrs Marper** is a project started by Ironboy at Node Hill.

It extends the [MARP](https://marp.app) concept by allowing:

* Auto generation of completely stand alone HTML files (with fonts, css and images embedded).
*  Generation of much smaller PDF:s than standard MARP can accomplish.
* Generation of PPTX/PowerPoint files with internal and external links intact.
* Hyphenation and word-spacing for justified text. Our goal is to achieve good typography with correct hyphenation and a mild variable letter-spacing that counteracts large spaces in justified text.

## Important! Install Ghostscript
For PDF creation/compression to work:

GhostScript must be installed on the computer and accessible as a global path via the 'gs' command in the terminal/shell. See installation settings:

#### Windows (as well as Linux Snap)
https://ghostscript.com/releases/gsdnld.html

*Note:* Select the correct OS + AGPL License

#### Mac
```
brew install ghostscript
```

*Note:* Install HomeBrew first if not already installed: https://brew.sh

#### Debian/Ubuntu
```
sudo apt-get -y install ghostscript
```

## Install Node.js and VSCode
1. Make sure Node.js and VSCode (Visual Studio Code) are installed!
2. Use VSC (Visual Studio Code) as your code editor.
3. In Visual Studio Code, install the following extension: 
*Marp for VS Code*.
4. In the terminal (inside VSC) run the **npm install** command.

## Watch markdown and preview as Marp in VSC
Assuming you have installed Marp for VS Code:
1. Open index.md
2. Click on the preview symbol in the upper corner (pages with magnifying glass).
3. Note: The appearance is controlled by the *theme.css* file - but you have to set this once in VSC: Click on the Marp symbol and select "Open extension settings", then on *Add item* at the bottom of the list and write in "./theme.css"

## Generate finished HTML and PDF from markdown
Don't forget to run **npm install**, then:

1. Type **npm run make** in the terminal.
2. A folder named **dist** is created with an HTML version and a PDF version of the presentation.

(Note: *Don't* use the Marp VSC extension command "Export slide deck" - to create your slides it doesn't give as good results as using **Mrs Marper**, running **npm run make**.)

# Documentation of the Mrs Marper code base 

The **Mrs Marper** code base can be found in the **make** folder.

## Coding style &ndash; some ground rules
We're rather relaxed. But there are some important guidelines you really *should* follow:
* Name your functions, variables and parameters so that they can be easily understood. (With the exeception of parameter names for very short lambda like functions, where short code is easier to follow.)
* At the start of each file write a short description as a [JavaDoc](https://www.oracle.com/technical-resources/articles/java/javadoc-tool.html) style comment with one bullet point per line (using "-" for bullets) - see how we've done it our files so far - follow that pattern!
* **Never** have more than 50 lines of code in a single JS file! Refactor and split if that limit is reached!
* Install and use the excellent VSC extension [Uncanny Cognitive Complexity](https://marketplace.visualstudio.com/items?itemName=Dabolus.uncanny-cognitive-complexity) to judge the complexity of each of your JS files. Try to keep things simple, below the measurement 10, and never go haywire (you **must** keep things below 20). Keep Mr Incredible happy! (You can read [more about Cognitive Complexity here](https://www.baeldung.com/java-cognitive-complexity).). You can also run **npm run test-cc** to see the complexity listed for all files.
* Don't uses classes and OOP &ndash; this application is a bunch of JS functions and that is a *deliberate choice*. Much less cruft in this particular case, although OOP is a better fit in other cases...
* *Note* that all *export*:s are automatically *imported* and made in to global variables in **_index.js**, so follow that convention and *don't* add *any* import statements in your files!
* *Only* comment things that are really hard to understand even if you know JS. **And** things that are domain specific.
* *Always* move things that you feel might be good to reach as *settings/options* to *make/__settings.js*. And, in *__settings.js*, comment what the setting actually does!
* End your lines with ";".

## __settings.js

#### Description
- Global settings affecting conversion, image quality and typography

#### Exports
* settings

#### Used by
* *_make* from [_make.js](#_makejs)
* *_makePart2* from [_makePart2.js](#_makepart2js)
* *addAndMassageSettings* from [addAndMassageSettings.js](#addandmassagesettingsjs)
* *adjustLetterSpacing* from [adjustLetterSpacing.js](#adjustletterspacingjs)
* *applyHyphenation* from [applyHyphenation.js](#applyhyphenationjs)
* *compressPDF* from [compressPDF.js](#compresspdfjs)
* *fixSloppyPDFCropbox* from [fixSloppyPDFCropbox.js](#fixsloppypdfcropboxjs)
* *getSpaceWidths* from [getSpaceWidths.js](#getspacewidthsjs)
* *hyphenate* from [hyphenate.js](#hyphenatejs)
* *includeLetterSpacer* from [includeLetterSpacer.js](#includeletterspacerjs)
* *includeWordSpacing* from [includeWordSpacing.js](#includewordspacingjs)
* *makePdfFromHtml* from [makePdfFromHtml.js](#makepdffromhtmljs)
* *makePptx* from [makePptx.js](#makepptxjs)
* *pdfMetaData* from [pdfMetaData.js](#pdfmetadatajs)
* *scaleImage* from [scaleImage.js](#scaleimagejs)
* *setHTMLLanguage* from [setHtmlLanguage.js](#sethtmllanguagejs)

#### Code

*File:* [make/__settings.js](make/__settings.js)

*Cognitive Complexity:* 0

```js
export const settings = {
  /* which formats to create apart from html (which is always created) */
  makePDF: 1,
  makeJPGs: 1,
  makePPTX: 1,
  /* hyphenation */
  hyphenateTags: ['p', 'li', 'th', 'td'],
  hyphenateMinWordLength: 6,
  hyphenateMinCharsBefore: 3,
  hyphenateMinCharsAfter: 3,
  /* word-spacing / extra width for a space */
  wordSpacingRem: 0.02,
  /* variable letter-spacing (counteracts big spaces on hyphenation) */
  letterSpacingMinRem: -0.02,
  letterSpacingMaxRem: 0.02,
  /* jpg settings compression before embedding in html */
  sharpScaleJpgsTo: 1500,
  sharpJpgQuality: 65,
  /* JPG quality and deviceScaleFactor, jpg screenshots from puppeteer */
  deviceScaleFactor: 2,
  jpgScreenshotQuality: 70,
  /* PDF, image quality, LO to HI: screen, ebook, printer, prepress */
  ghostScriptPdfQuality: 'prepress',
  /* crop PDF file and screenshots from Puppeteer
     slightly to avoid tiny white stripes along sides */
  pdfCropPercent: 0.15
}
```

---
## _index.js

#### Description
- Load/import all JS code in the make folder
- Turn every imported asset into a global variable
- Calls _make() to start the conversion process

#### Uses
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/_index.js](make/_index.js)

*Cognitive Complexity:* 2

```js
/* 
   Thomas Frank 2023 
   * Make a self-contained html file from MARP Markdown
     (includes css, fonts and images - no external dependencies)
   * Make a PDF file from MARP Markdown (via the html file)
   * Also scales and jpg compresses images in the files
   * And uses GhostScript to compress the PDF
*/

import { readdirSync } from 'fs';
import { dirname } from 'path';
import { fileURLToPath } from 'url';
const __dirname = dirname(fileURLToPath(import.meta.url));

// import all scripts in this folder and start _make
(async () => {
  process.chdir(__dirname);
  for (let file of readdirSync('./')) {
    file !== '_index.js' && file.slice(-3) === '.js' &&
      Object.assign(globalThis, await import('./' + file));
  }
  process.chdir('../');
  _make();
})();
```

---
## _loadDependencies.js

#### Description
- Loads (imports/requires) all NPM module dependences
- Exports all the dependencies as globals

#### Exports
* PDFDocument
* execSync
* existsSync
* marpCli
* mkdirSync
* pptxgen
* puppeteer
* readFileSync
* renameSync
* rmSync
* sharp
* statSync
* writeFileSync

#### Code

*File:* [make/_loadDependencies.js](make/_loadDependencies.js)

*Cognitive Complexity:* 0

```js
// Load (import/require) dependecies 
import {
  readFileSync, writeFileSync, statSync,
  renameSync, mkdirSync, rmSync, existsSync
} from "fs";
import { execSync } from 'child_process';
import { PDFDocument } from 'pdf-lib';
import puppeteer from 'puppeteer';
import pptxgen from "pptxgenjs";
import { createRequire } from "module";
const require = createRequire(import.meta.url);
const { marpCli } = require('@marp-team/marp-cli');
const sharp = require('sharp');

// Export dependencies
export {
  readFileSync, writeFileSync, statSync,
  renameSync, mkdirSync, rmSync, existsSync,
  execSync,
  PDFDocument,
  puppeteer,
  pptxgen,
  marpCli,
  sharp
};
```

---
## _make.js

#### Description
- Main/start function
- Makes HTML, PDF, JPG and PPTX files from index.md

#### Exports
* _make

#### Uses
* *settings* from [__settings.js](#__settingsjs)
* *_makePart2* from [_makePart2.js](#_makepart2js)
* *addAndMassageSettings* from [addAndMassageSettings.js](#addandmassagesettingsjs)
* *cleanupHtmlForLinters* from [cleanupHtmlForLinters.js](#cleanuphtmlforlintersjs)
* *embedFonts* from [embedFonts.js](#embedfontsjs)
* *embedImages* from [embedImages.js](#embedimagesjs)
* *hyphenate* from [hyphenate.js](#hyphenatejs)
* *includeLetterSpacer* from [includeLetterSpacer.js](#includeletterspacerjs)
* *includeWordSpacing* from [includeWordSpacing.js](#includewordspacingjs)
* *makeHtml* from [makeHtml.js](#makehtmljs)
* *makeLinkTargetsBlankAdd* from [makeLinkTargetsBlankAdd.js](#makelinktargetsblankaddjs)
* *preWarmMakePDFFromHtml* from [preWarmMakePdfFromHtml.js](#prewarmmakepdffromhtmljs)
* *setHTMLLanguage* from [setHtmlLanguage.js](#sethtmllanguagejs)

#### Code

*File:* [make/_make.js](make/_make.js)

*Cognitive Complexity:* 2

```js
export async function _make() {
  addAndMassageSettings();
  let { makeJPGs } = settings;
  console.warn = () => { }; // silence marp
  let r = (x) => {
    r2(x, (Date.now() - lastTime) + ' ms');
    lastTime = Date.now();
  }
  let r2 = (x, y = '') => {
    y += '';
    console.log(x.padEnd(58 - y.length, ' ') + y);
  }
  let startTime = Date.now(), lastTime = startTime;
  let preWarmedPromise = preWarmMakePDFFromHtml();
  existsSync('./dist') &&
    rmSync('./dist', { recursive: true, force: true });
  mkdirSync('./dist');
  makeJPGs && mkdirSync('./dist/jpgs');
  r2('');
  r2('MRS MARPER - by Ironboy')
  r2('-'.repeat(58));
  await makeHtml();
  r('HTML -> Created index.html.');
  let html = readFileSync('./index.html', 'utf-8');
  html = setHTMLLanguage(html);
  let { html: htm, language: lang } = await hyphenate(html);
  html = htm;
  r('HTML -> Hyphenation done (language: ' + lang + ')');
  html = includeWordSpacing(html);
  r('HTML -> Included code for word spacing.')
  html = includeLetterSpacer(html);
  r('HTML -> Included code for letter spacing.')
  html = makeLinkTargetsBlankAdd(html);
  r('HTML -> Made external links open in new tab.');
  html = await embedImages(html);
  r('HTML -> Embedded images.');
  html = embedFonts(html);
  r('HTML -> Embedded fonts.');
  html = cleanupHtmlForLinters(html);
  r('HTML -> Cleaned up for linters.');
  writeFileSync('./index.html', html, 'utf-8');;
  renameSync('./index.html', './dist/index.html');
  await _makePart2(preWarmedPromise, startTime, r, r2);
}
```

---
## preWarmMakePdfFromHtml.js

#### Description
- Starts Puppeteer early to have it ready when needed

#### Exports
* preWarmMakePDFFromHtml

#### Used by
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/preWarmMakePdfFromHtml.js](make/preWarmMakePdfFromHtml.js)

*Cognitive Complexity:* 0

```js
export async function preWarmMakePDFFromHtml() {
  let browser = await puppeteer.launch({ headless: 'new' });
  let page = await browser.newPage();
  return { browser, page };
}
```

---
## makeHtml.js

#### Description
- Creates the HTML file using MARP CLI

#### Exports
* makeHtml

#### Used by
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/makeHtml.js](make/makeHtml.js)

*Cognitive Complexity:* 0

```js
export async function makeHtml() {
  await marpCli([
    'index.md', '--html',
    '--allow-local-files',
    '--theme', 'theme.css'
  ]).catch(console.error);
}
```

---
## embedFonts.js

#### Description
- Embeds the fonts in the HTML file

#### Exports
* embedFonts

#### Used by
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/embedFonts.js](make/embedFonts.js)

*Cognitive Complexity:* 1

```js
export function embedFonts(html) {
  // replace import from google fonts with locally downloaded fonts
  // (see https://gwfh.mranftl.com/fonts)
  // ...the reason for not using these in theme.css is that they
  // don't work with marp preview in VSC...
  let fonts = '\n' + readFileSync('./fonts.css') + '\n';
  html = html.replace(/\@import url\('https:\/\/fonts.googleapis.com[^\)]*\);/, fonts);
  let fontUrls = JSON.parse(JSON.stringify([...html.matchAll(/url\('\.\.\/fonts\/[^;]*;/g)])).map(x => x[0]);
  let fontPaths = fontUrls.map(x => './fonts/' + x.split('fonts/')[1].split('\') format')[0]);
  let prefix = 'url(data:application/x-font-woff;charset=utf-8;base64,';
  let postfix = ") format('woff');"
  let fontsBin = fontPaths.map(x => prefix + readFileSync(x).toString('base64') + postfix);
  for (let i = 0; i < fontsBin.length; i++) {
    html = html.split(fontUrls[i]).join(fontsBin[i]);
  }
  // make sure we end the style tag and start another onE (important for cleanupHtml)
  html = html.replace(fontsBin.slice(-1)[0], x => x + 'END-OF-FONT-INCLUSION');
  html = html.replace(/END-OF-FONT-INCLUSION[^\}]*\}/, '}\n</style>\n<style>\n');
  return html;
}
```

---
## cleanupHtmlForLinters.js

#### Description
- Cleanup of HTML (mostly included style attributes)
- Makes the HTML valid in linters such as VSC:s built in linter

#### Exports
* cleanupHtmlForLinters

#### Used by
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/cleanupHtmlForLinters.js](make/cleanupHtmlForLinters.js)

*Cognitive Complexity:* 1

```js
export function cleanupHtmlForLinters(html) {
  // no empty style attribute
  html = html.replace(/style=""/g, '');
  html = html.split(' style="');
  let cleaned = [];
  // no escaped &lt; or &gt in style attributes
  // replace with < and >
  for (let part of html) {
    let [style, ...rest] = part.split('"');
    style = style
      .replace(/\&lt\;/g, '<')
      .replace(/\&gt\;/g, '>')
    cleaned.push([style, ...rest].join('"'));
  }
  html = cleaned.join(' style="');
  // enumerate style tags
  let i = 1;
  html = html.replace(/<style>/g, x => `<style class="style-${i++}">`);
  // replace style tag 3 with link tag and base 64 encoded css since linters
  // (the one in VSC for example) otherwise complains about non-standard rules
  let sContent = html.match(/<style class="style-3">.*?<\/style>/s) + '';
  let sContentInner = sContent.slice(
    sContent.indexOf('>') + 1, sContent.lastIndexOf('<')
  );
  let base64Inner = 'data:text/css;base64,'
    + Buffer.from(sContentInner, "utf-8").toString('base64');
  html = html.split(sContent)
    .join(`<link rel="stylesheet" href="${base64Inner}">`);
  return html;
}
```

---
## setHtmlLanguage.js

#### Description
- Sets the html lang attribute according to settings

#### Exports
* setHTMLLanguage

#### Uses
* *settings* from [__settings.js](#__settingsjs)

#### Used by
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/setHtmlLanguage.js](make/setHtmlLanguage.js)

*Cognitive Complexity:* 0

```js
export function setHTMLLanguage(html) {
  let { language } = settings;
  html = html.replace(/<html[^>]*>/g, `<html lang="${language}">`);
  return html;
}
```

---
## makeLinkTargetsBlankAdd.js

#### Description
- Includes client side code for opening external links in new tabs

#### Exports
* makeLinkTargetsBlankAdd

#### Uses
* *makeLinkTargetsBlank* from [makeLinkTargetsBlank.js](#makelinktargetsblankjs)

#### Used by
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/makeLinkTargetsBlankAdd.js](make/makeLinkTargetsBlankAdd.js)

*Cognitive Complexity:* 0

```js
export function makeLinkTargetsBlankAdd(html) {
  html = html.split('</body>').join('<script>' + makeLinkTargetsBlank + ';makeLinkTargetsBlank();</script></body>');
  return html;
}
```

---
## makeLinkTargetsBlank.js

#### Description
- Client side code assuring that external links opens in new tabs

#### Exports
* makeLinkTargetsBlank

#### Used by
* *makeLinkTargetsBlankAdd* from [makeLinkTargetsBlankAdd.js](#makelinktargetsblankaddjs)

#### Code

*File:* [make/makeLinkTargetsBlank.js](make/makeLinkTargetsBlank.js)

*Cognitive Complexity:* 4

```js
export function makeLinkTargetsBlank() {
  document.body.addEventListener('click', e => {
    let a = e.target.closest('a');
    if (!a) { return; }
    if (a.getAttribute('href').indexOf('http') === 0) {
      a.setAttribute('target', '_blank');
    }
  });
}
```

---
## includeWordSpacing.js

#### Description
- Includes the word spacing as a css rule

#### Exports
* includeWordSpacing

#### Uses
* *settings* from [__settings.js](#__settingsjs)

#### Used by
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/includeWordSpacing.js](make/includeWordSpacing.js)

*Cognitive Complexity:* 0

```js
export function includeWordSpacing(html) {
  let { wordSpacingRem } = settings;
  html = html.split('</head>').join(/*css*/`
    <style>
    a-space {
      letter-spacing: ${wordSpacingRem}rem;
    }
    </style>
    </head>
  `);
  return html;
}
```

---
## addAndMassageSettings.js

#### Description
- Adjusts/unfolds some setting parameters
- Imports settings given in index.md

#### Exports
* addAndMassageSettings

#### Uses
* *settings* from [__settings.js](#__settingsjs)

#### Used by
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/addAndMassageSettings.js](make/addAndMassageSettings.js)

*Cognitive Complexity:* 4

```js
export function addAndMassageSettings() {
  // "unpack" settings for sharp
  settings.resizeSettings = [
    settings.sharpScaleJpgsTo,
    settings.sharpScaleJpgsTo,
    { fit: 'inside' }
  ];
  settings.jpegSettings = [{
    mozjpeg: true,
    quality: settings.sharpJpgQuality
  }];

  // can't make PPTX without JPGs - but we can decide if to keep them
  settings.keepJPGs = settings.makeJPGs;
  settings.makePPTX && (settings.makeJPGs = 1);

  // readMarpSettings
  let x = readFileSync('./index.md', 'utf-8').split('---')[1];
  x.split('\n')
    .map(x => x.split(':').map(x => x.trim()))
    .forEach(([key, val]) => {
      if (!key || !val || key === 'marp') { return; }
      settings[key] = val;
    });
}
```

---
## hyphenate.js

#### Description
- Hyphenates the text using the hyphen npm module

#### Exports
* hyphenate

#### Uses
* *settings* from [__settings.js](#__settingsjs)
* *applyHyphenation* from [applyHyphenation.js](#applyhyphenationjs)

#### Used by
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/hyphenate.js](make/hyphenate.js)

*Cognitive Complexity:* 5

```js
export async function hyphenate(html) {
  let { language } = settings;
  // get correct hyphenator dependning on language  - fallback to 'en'
  let hyphenator;
  while (!hyphenator) {
    hyphenator = await import('hyphen/' + language + '/index.js')
      .catch(e => { });
    if (!hyphenator && language.includes('-')) {
      language = language.split('-')[0]
    }
    else if (!hyphenator) {
      language = 'en';
    }
  }
  // apply hyphenation
  hyphenator = hyphenator.default.hyphenateHTMLSync;
  html = applyHyphenation(hyphenator, html);
  return { html, language };
}
```

---
## applyHyphenation.js

#### Description
- Apply hyphenation according to settings

#### Exports
* applyHyphenation

#### Uses
* *settings* from [__settings.js](#__settingsjs)

#### Used by
* *hyphenate* from [hyphenate.js](#hyphenatejs)

#### Code

*File:* [make/applyHyphenation.js](make/applyHyphenation.js)

*Cognitive Complexity:* 9

```js
export function applyHyphenation(hyphenator, html) {
  let {
    hyphenateTags: els,
    hyphenateMinWordLength: minWordLength,
    hyphenateMinCharsBefore: minCharsBefore,
    hyphenateMinCharsAfter: minCharsAfter,
  } = settings;
  // hyphenate
  for (let el of els) {
    let reg = new RegExp(`<${el}[^>]*>.*?<\\/${el}>`, 'g');
    html = html.replace(reg, x => {
      let a = hyphenator(x, { minWordLength });
      // adhere to minCharsBefore and minCharsAfter
      let b = a.split('\u00AD');
      let c = '';
      for (let i = 0; i < b.length - 1; i++) {
        let keep = !(b[i].slice(-minCharsBefore).replace(/[\p{L}-]/ug, ''))
          && !(b[i + 1].slice(0, minCharsAfter).replace(/[\p{L}-]/ug, ''));
        c += b[i] + (keep ? '\u00AD' : '');
      }
      c += b.slice(-1);
      return c;
    });
  }
  return html;
}
```

---
## embedImages.js

#### Description
- Embeds the images in the HTML file

#### Exports
* embedImages

#### Uses
* *bgImagesToClasses* from [bgImagesToClasses.js](#bgimagestoclassesjs)
* *removeQuotes* from [removeQuotes.js](#removequotesjs)
* *scaleImage* from [scaleImage.js](#scaleimagejs)

#### Used by
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/embedImages.js](make/embedImages.js)

*Cognitive Complexity:* 2

```js
export async function embedImages(html) {
  html = bgImagesToClasses(html);
  let htmlImages = html.split('img src="').slice(1).map(x => x.split('"')[0]);
  let cssImages = html.split('background-image:url(').slice(1).map(x => removeQuotes(x.split(')')[0]));
  cssImages = cssImages.filter(x => x.indexOf('data') !== 0);
  let imagePaths = [...htmlImages, ...cssImages];
  let images = [];
  for (let path of imagePaths) {
    let type = path.split('.').slice(-1)[0];
    images.push(`data:image/${type};base64,`
      + (await scaleImage(readFileSync('./' + path), type)).toString('base64'));
  }
  for (let i = 0; i < images.length; i++) {
    html = html.split(imagePaths[i]).join(images[i]);
  }
  return html;
}
```

---
## removeQuotes.js

#### Description
- Remove three different types of quotes from a string

#### Exports
* removeQuotes

#### Used by
* *embedImages* from [embedImages.js](#embedimagesjs)

#### Code

*File:* [make/removeQuotes.js](make/removeQuotes.js)

*Cognitive Complexity:* 0

```js
export function removeQuotes(x) {
  return x
    .split('"').join('')
    .split("'").join('')
    .split('&quot;').join('')
}
```

---
## bgImagesToClasses.js

#### Description
- Converts bg images to classes (avoids double embedding)

#### Exports
* bgImagesToClasses

#### Used by
* *embedImages* from [embedImages.js](#embedimagesjs)

#### Code

*File:* [make/bgImagesToClasses.js](make/bgImagesToClasses.js)

*Cognitive Complexity:* 2

```js
export function bgImagesToClasses(html) {
  let i = 0;
  let hash = {};
  html = html.replace(/<figure style="background-image[^>]*>/g, (x => {
    i++;
    hash[x] = hash[x] || [];
    hash[x].push(i);
    return `<figure class="bg-image-${i}">`;
  }));
  let style = "\n";
  for (let [key, val] of Object.entries(hash)) {
    let selector = val.map(x => 'figure.bg-image-' + x).join(', ');
    style += selector + ' {\n  ' + key.split('"')[1].split('&quot;').join("'").slice(0, -1) + '!important;\n}\n';
  }
  style += '\n';
  html = html.replace(/<\/style>/, style + '</style>');
  return html;
}
```

---
## scaleImage.js

#### Description
- Scales imags using the npm module sharp

#### Exports
* scaleImage

#### Uses
* *settings* from [__settings.js](#__settingsjs)

#### Used by
* *embedImages* from [embedImages.js](#embedimagesjs)

#### Code

*File:* [make/scaleImage.js](make/scaleImage.js)

*Cognitive Complexity:* 1

```js
export async function scaleImage(buffer, type) {
  type === 'jpg' && (type = 'jpeg');
  let { resizeSettings, jpegSettings } = settings;
  return sharp(buffer)
    .resize(...resizeSettings)
  [type](...jpegSettings)
    .toBuffer();
};
```

---
## _makePart2.js

#### Description
- Part 2 of main/start function
- Makes HTML, PDF, JPG and PPTX files from index.md

#### Exports
* _makePart2

#### Uses
* *settings* from [__settings.js](#__settingsjs)
* *compressPDF* from [compressPDF.js](#compresspdfjs)
* *fixSloppyPDFCropbox* from [fixSloppyPDFCropbox.js](#fixsloppypdfcropboxjs)
* *makePdfFromHtml* from [makePdfFromHtml.js](#makepdffromhtmljs)
* *makePptx* from [makePptx.js](#makepptxjs)

#### Used by
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/_makePart2.js](make/_makePart2.js)

*Cognitive Complexity:* 6

```js
export async function _makePart2(preWarmedPromise, startTime, r, r2) {
  let { makePDF, makePPTX: mPPTX, keepJPGs } = settings;
  let { widthMm, heightMm, pagePaths, pages, allLinkPositions }
    = await makePdfFromHtml(r, preWarmedPromise);
  console.log('-'.repeat(58));
  if (makePDF) {
    r('PDF  -> Created index.pdf.');
    compressPDF();
    r('PDF  -> Compressed PDF.');
    rmSync('./index.pdf');
    await fixSloppyPDFCropbox(r);
    r('PDF  -> Fixed crop box.');
    r2('-'.repeat(58));
  }
  if (mPPTX) {
    await makePptx(widthMm, heightMm, pagePaths, allLinkPositions);
    r('PPTX -> Generated.');
    r2('-'.repeat(58));
  }
  r2('All done!');
  r2('-'.repeat(58));
  r2('Number of pages:', pages);
  r2('Total time taken:',
    ((Date.now() - startTime) / 1000).toFixed(2) + ' sec');
  !keepJPGs && rmSync('./dist/jpgs', { recursive: true, force: true });
  let s = x => (x / 1024 / 1024).toFixed(2) + '  MB';
  r2('MB/page in HTML:', s(statSync('./dist/index.html').size / pages))
  r2('HTML file size:', s(statSync('./dist/index.html').size));
  r2('PDF  file size:', s(statSync('./dist/index.pdf').size));
  let jpgSize = keepJPGs && pagePaths.map(x => statSync(x).size).reduce((a, c) => a + c);
  keepJPGs && r2('JPGs file size:', s(jpgSize));
  mPPTX && r2('PPTX file size:', s(statSync('./dist/index.pptx').size));
  r2('-'.repeat(58));
}
```

---
## compressPDF.js

#### Description
- Compress the PDF using Ghostscript

#### Exports
* compressPDF

#### Uses
* *settings* from [__settings.js](#__settingsjs)

#### Used by
* *_makePart2* from [_makePart2.js](#_makepart2js)

#### Code

*File:* [make/compressPDF.js](make/compressPDF.js)

*Cognitive Complexity:* 0

```js
export function compressPDF() {
  let { ghostScriptPdfQuality: q } = settings;
  execSync(
    `gs -sDEVICE=pdfwrite -dCompatibilityLevel=1.7 ` +
    `-dPDFSETTINGS=/${q} -dNOPAUSE -dQUIET` +
    `-dBATCH -sOutputFile=dist/index.pdf index.pdf`
  );
}
```

---
## makePptx.js

#### Description
- Creates a PPTX/PowerPoint using the npm module pptxgenjs

#### Exports
* makePptx

#### Uses
* *settings* from [__settings.js](#__settingsjs)
* *addPptxSlideLinks* from [addPptxSlideLinks.js](#addpptxslidelinksjs)

#### Used by
* *_makePart2* from [_makePart2.js](#_makepart2js)

#### Code

*File:* [make/makePptx.js](make/makePptx.js)

*Cognitive Complexity:* 1

```js
export async function makePptx(widthMm, heightMm, pagePaths, allLinkPositions) {
  let { author, title, description } = settings;
  let cFactorInches = 0.0393700787;
  let width = widthMm * cFactorInches, height = heightMm * cFactorInches;
  let pptx = new pptxgen();
  pptx.author = author;
  pptx.company = author;
  pptx.subject = description;
  pptx.title = title;
  await pptx.defineLayout({ name: 'cSize', width, height });
  for (let path of pagePaths) {
    let slide = await pptx.addSlide();
    await slide.addImage({ path, x: 0, y: 0, w: '100%', h: '100%' });
    // add links (previously extracted in makePDFFromHtml)
    await addPptxSlideLinks(slide, allLinkPositions.shift());
  }
  await pptx.writeFile({ fileName: './dist/index.pptx', compression: true });
}
```

---
## addPptxSlideLinks.js

#### Description
- Adds hyperlinks to PPTX/PowerPoint

#### Exports
* addPptxSlideLinks

#### Used by
* *makePptx* from [makePptx.js](#makepptxjs)

#### Code

*File:* [make/addPptxSlideLinks.js](make/addPptxSlideLinks.js)

*Cognitive Complexity:* 5

```js
export async function addPptxSlideLinks(slide, links) {
  for (let link of links) {
    await slide.addText(' ', {
      hyperlink: link.href[0] !== '#' ?
        { url: link.href } :
        { slide: link.href.slice(1) },
      tooltip: link.href[0] !== '#' ?
        link.href :
        'Slide ' + link.href.slice(1),
      x: link.x + '%',
      y: link.y + '%',
      w: (link.right - link.x) + '%',
      h: (link.bottom - link.y) + '%'
    });
  }
}
```

---
## fixSloppyPDFCropbox.js

#### Description
- Crops the PDF very slightly to avoid thin white page borders

#### Exports
* fixSloppyPDFCropbox

#### Uses
* *settings* from [__settings.js](#__settingsjs)
* *pdfMetaData* from [pdfMetaData.js](#pdfmetadatajs)

#### Used by
* *_makePart2* from [_makePart2.js](#_makepart2js)

#### Code

*File:* [make/fixSloppyPDFCropbox.js](make/fixSloppyPDFCropbox.js)

*Cognitive Complexity:* 1

```js
export async function fixSloppyPDFCropbox(r) {
  const existingPdfBytes = readFileSync('./dist/index.pdf');
  const pdfDoc = await PDFDocument.load(existingPdfBytes);
  pdfMetaData(pdfDoc, r);
  const pages = pdfDoc.getPages();
  let cropPercent = settings.pdfCropPercent;
  for (let page of pages) {
    const { width, height } = page.getCropBox();
    let cropPointsW = width * cropPercent / 100;
    let cropPointsH = height * cropPercent / 100;
    page.setCropBox(cropPointsW, cropPointsH,
      width - cropPointsW * 2, height - cropPointsH * 2);
  }
  const pdfBytes = await pdfDoc.save();
  writeFileSync('./dist/index.pdf', pdfBytes);
}
```

---
## pdfMetaData.js

#### Description
- Sets PDF meta data

#### Exports
* pdfMetaData

#### Uses
* *settings* from [__settings.js](#__settingsjs)

#### Used by
* *fixSloppyPDFCropbox* from [fixSloppyPDFCropbox.js](#fixsloppypdfcropboxjs)

#### Code

*File:* [make/pdfMetaData.js](make/pdfMetaData.js)

*Cognitive Complexity:* 0

```js
export function pdfMetaData(pdfDoc, r) {
  let { author, language, title, description } = settings;
  pdfDoc.setTitle(title);
  pdfDoc.setSubject(description);
  pdfDoc.setAuthor(author);
  pdfDoc.setLanguage(language);
  pdfDoc.setProducer(author + '\'s toolbox');
  pdfDoc.setCreator(author);
  r('PDF  -> Modified meta data.');
}
```

---
## makePdfFromHtml.js

#### Description
- Uses Puppeteer to create a PDF and JPG:s
- Gathers link position info for PPTX/PowerPoint creation

#### Exports
* makePdfFromHtml

#### Uses
* *settings* from [__settings.js](#__settingsjs)
* *cleanupAndGetPageLength* from [cleanupAndGetPageLength.js](#cleanupandgetpagelengthjs)
* *getLinkPositions* from [getLinkPositions.js](#getlinkpositionsjs)
* *getPageDimensions* from [getPageDimensions.js](#getpagedimensionsjs)

#### Used by
* *_makePart2* from [_makePart2.js](#_makepart2js)

#### Code

*File:* [make/makePdfFromHtml.js](make/makePdfFromHtml.js)

*Cognitive Complexity:* 7

```js
export async function makePdfFromHtml(r, preWarmedPromise) {
  let { makePDF, makeJPGs, makePPTX: mPPTX, keepJPGs } = settings;
  let { browser, page } = await preWarmedPromise;
  let url = import.meta.url.split('/make/')[0] + '/dist/index.html';
  await page.goto(url);
  let { deviceScaleFactor, jpgScreenshotQuality: quality, pdfCropPercent } = settings;
  // get the dimensions of a section/page in mm
  let { widthPx, heightPx, widthMm, heightMm } =
    await page.$eval('body', getPageDimensions);
  // set view port to page size
  let cropF = (100 - pdfCropPercent * 2) / 100;
  await page.setViewport({
    width: Math.floor(widthPx * cropF),
    height: Math.floor(heightPx * cropF),
    deviceScaleFactor
  });
  // if we don't visit pages with code listings the code listing will
  // not show/print - so visit all pages :) 
  // + take screenshots
  let pages = await page.$eval('body', cleanupAndGetPageLength);
  let pagePaths = [], allLinkPositions = [];
  for (let i = 1; i <= pages; i++) {
    let path = `./dist/jpgs/${(i + '').padStart(5, '0')}.jpg`;
    pagePaths.push(path);
    let linkPositions = await page.$eval('body', getLinkPositions, i, mPPTX);
    allLinkPositions.push(linkPositions.map(x => {
      let b = { ...x };
      b.x = b.x * 100 / widthPx;
      b.y = b.y * 100 / heightPx;
      b.right = b.right * 100 / widthPx;
      b.bottom = b.bottom * 100 / heightPx;
      return b;
    }));
    makeJPGs && await page.screenshot({ path, type: "jpeg", quality });
  }
  makeJPGs && console.log('-'.repeat(58));
  makeJPGs && r('JPGs -> Generated.' + (keepJPGs ? '' : ' (For PPTX, removed later.)'));
  makeJPGs && allLinkPositions.filter(x => x.length).length
    && (console.log('-'.repeat(58)), r('Link -> Links for PPTX extracted.'));
  // now we can print to pdf
  if (makePDF) {
    let pdf = await page.pdf({ width: widthMm + 'mm', height: heightMm + 'mm' });
    writeFileSync('./index.pdf', pdf);
  }
  await browser.close();
  return { widthMm, heightMm, pagePaths, pages, allLinkPositions };
}
```

---
## getPageDimensions.js

#### Description
- Helps Puppeteer get the page dimensions

#### Exports
* getPageDimensions

#### Used by
* *makePdfFromHtml* from [makePdfFromHtml.js](#makepdffromhtmljs)

#### Code

*File:* [make/getPageDimensions.js](make/getPageDimensions.js)

*Cognitive Complexity:* 0

```js
// note: runs from makePdfFromHtml inside puppeteer browser page
export function getPageDimensions(el) {
  let tempDiv = document.createElement('div');
  tempDiv.style.width = '100mm';
  el.append(tempDiv);
  let pxPerMm = getComputedStyle(tempDiv).width.split('px')[0] / 100;
  let section = document.querySelector('section');
  let { width: widthPx, height: heightPx } = getComputedStyle(section);
  widthPx = +widthPx.split('px')[0];
  heightPx = +heightPx.split('px')[0];
  let widthMm = Math.round(widthPx / pxPerMm);
  let heightMm = Math.round(heightPx / pxPerMm);
  widthPx = Math.round(widthPx);
  heightPx = Math.round(heightPx);
  tempDiv.remove();
  return { pxPerMm, widthPx, heightPx, widthMm, heightMm };
}
```

---
## getLinkPositions.js

#### Description
- Get link positiions so they can be included in the PPTX/PowerPint

#### Exports
* getLinkPositions

#### Used by
* *makePdfFromHtml* from [makePdfFromHtml.js](#makepdffromhtmljs)

#### Code

*File:* [make/getLinkPositions.js](make/getLinkPositions.js)

*Cognitive Complexity:* 1

```js
// note: runs from makePdfFromHtml inside puppeteer browser page
export function getLinkPositions(el, i, mPPTX) {
  location.hash = '#' + i;
  if (!mPPTX) { return []; }
  return [...document.querySelectorAll(`#x${i} a[href]`)]
    .map(x => {
      let bRect = x.getBoundingClientRect();
      return {
        href: x.getAttribute('href'),
        x: bRect.x, y: bRect.y, right: bRect.right, bottom: bRect.bottom
      };
    })
    .filter(x => x.bottom !== 0);
}
```

---
## cleanupAndGetPageLength.js

#### Description
- Returns the page length
- Removes navigation tool bar (so not printed to PDF and JPG:s)

#### Exports
* cleanupAndGetPageLength

#### Used by
* *makePdfFromHtml* from [makePdfFromHtml.js](#makepdffromhtmljs)

#### Code

*File:* [make/cleanupAndGetPageLength.js](make/cleanupAndGetPageLength.js)

*Cognitive Complexity:* 0

```js
export function cleanupAndGetPageLength() {
  // change id:s of sections to valid id:s (must start with character)
  [...document.querySelectorAll('section[id]')].forEach(x => x.id = 'x' + x.id);
  // remove navigator (otherwise it shows in screenshots)
  document.querySelector('.bespoke-marp-osc').remove();
  // number of pages in document
  return document.querySelectorAll('section[id]').length;
}
```

---
## includeLetterSpacer.js

#### Description
- Includes the letter spacing logic in the HTML client side code

#### Exports
* includeLetterSpacer

#### Uses
* *settings* from [__settings.js](#__settingsjs)
* *adjustLetterSpacing* from [adjustLetterSpacing.js](#adjustletterspacingjs)
* *findBestLetterSpacing* from [findBestLetterSpacing.js](#findbestletterspacingjs)
* *getSpaceWidths* from [getSpaceWidths.js](#getspacewidthsjs)
* *nonJustify* from [nonJustify.js](#nonjustifyjs)
* *reJustify* from [reJustify.js](#rejustifyjs)
* *textNodesUnder* from [textNodesUnder.js](#textnodesunderjs)
* *wrapWords* from [wrapWords.js](#wrapwordsjs)

#### Used by
* *_make* from [_make.js](#_makejs)

#### Code

*File:* [make/includeLetterSpacer.js](make/includeLetterSpacer.js)

*Cognitive Complexity:* 0

```js
export function includeLetterSpacer(html) {
  let code = [
    'const settings = ' + JSON.stringify(settings),
    adjustLetterSpacing,
    findBestLetterSpacing,
    textNodesUnder,
    wrapWords,
    getSpaceWidths,
    nonJustify,
    reJustify
  ].map(x => x + '').join('\n\n');
  code = `(()=>{\n${code};\n\nadjustLetterSpacing();})();`;
  html = html.split('</body>').join(`<script>${code}</script></body>`);
  return html;
}
```

---
## adjustLetterSpacing.js

#### Description
- Adjust the letter-spacing for justified text to minimize gaps

#### Exports
* adjustLetterSpacing

#### Uses
* *settings* from [__settings.js](#__settingsjs)
* *findBestLetterSpacing* from [findBestLetterSpacing.js](#findbestletterspacingjs)
* *getSpaceWidths* from [getSpaceWidths.js](#getspacewidthsjs)
* *wrapWords* from [wrapWords.js](#wrapwordsjs)

#### Used by
* *includeLetterSpacer* from [includeLetterSpacer.js](#includeletterspacerjs)

#### Code

*File:* [make/adjustLetterSpacing.js](make/adjustLetterSpacing.js)

*Cognitive Complexity:* 11

```js
export async function adjustLetterSpacing(page = 1, loadPage) {
  loadPage = loadPage || +location.hash.slice(1);
  (!loadPage || isNaN(loadPage)) && (loadPage = 1);
  let {
    letterSpacingMinRem: minSpace,
    letterSpacingMaxRem: maxSpace
  } = settings;
  document.body.style.opacity = 0; // temp hide content
  await document.fonts.ready;
  let section = [...document.querySelectorAll('section')]
    .find(x => x.id.replace(/\D/g, '') === page + '');
  if (!section) {
    location.hash = '#' + loadPage;
    document.body.style.opacity = 1; // show content
    return;
  }
  location.hash = '#' + page;
  wrapWords(section);
  let spaces = getSpaceWidths();
  let step = (maxSpace - minSpace) / 50;
  for (let { el, baseW, words } of spaces) {
    if (el.offsetWidth === 0) { // space at end of line, no width, so find another space
      el = [...el.parentElement.querySelectorAll('a-space')]
        .filter(x => x.getBoundingClientRect().y === el.getBoundingClientRect().y)
        .find(x => x.offsetWidth !== 0) || el;
    }
    let candidates = [];
    for (let i = minSpace; i <= maxSpace; i += step) {
      words.forEach(w => w.style.letterSpacing = i + 'rem');
      candidates.push({ space: i, val: el.offsetWidth / baseW });
    }
    let best = findBestLetterSpacing(candidates);
    // (best.space - step, instead of best.space -> experimental, 
    //  sometimes minor diff between puppeteer print / pdf and html
    //  and in the "LIA-folder" test case this seems to fix that)
    words.forEach(w => w.style.letterSpacing = (best.space - step) + 'rem');
  }
  adjustLetterSpacing(page + 1, loadPage);
}
```

---
## findBestLetterSpacing.js

#### Description
- Find the base candidate among different letter spacings
- Closest to normal spacing
- If several options give the same spacing -> tigher kerning

#### Exports
* findBestLetterSpacing

#### Used by
* *adjustLetterSpacing* from [adjustLetterSpacing.js](#adjustletterspacingjs)
* *includeLetterSpacer* from [includeLetterSpacer.js](#includeletterspacerjs)

#### Code

*File:* [make/findBestLetterSpacing.js](make/findBestLetterSpacing.js)

*Cognitive Complexity:* 7

```js
export function findBestLetterSpacing(candidates) {
  return candidates.sort((a, b) => {
    if (a.val === b.val) {
      return Math.abs(a.space) < Math.abs(b.space) ? -1 : 1;
    }
    return a.val < b.val ? -1 : 1;
  })[0];
}
```

---
## wrapWords.js

#### Description
- Wraps words inside a-word tags
- Wraps spaces inside a-space tags
- Used for letter spacing

#### Exports
* wrapWords

#### Uses
* *textNodesUnder* from [textNodesUnder.js](#textnodesunderjs)

#### Used by
* *adjustLetterSpacing* from [adjustLetterSpacing.js](#adjustletterspacingjs)
* *includeLetterSpacer* from [includeLetterSpacer.js](#includeletterspacerjs)

#### Code

*File:* [make/wrapWords.js](make/wrapWords.js)

*Cognitive Complexity:* 8

```js
export function wrapWords(insideEl) {
  let nodes = textNodesUnder(insideEl)
    .filter(x => x.textContent.replace(/\n/g, '').length > 1);
  nodes.forEach(node => {
    let text = node.textContent, currentNode;
    for (let word of text.split(' ')) {
      if (currentNode) {
        let aSpace = document.createElement('a-space');
        aSpace.innerText = ' ';
        currentNode.after(aSpace);
        currentNode = aSpace;
      }
      let aWord = document.createElement('a-word');
      aWord.innerText = word;
      !currentNode ? node.replaceWith(aWord) : currentNode.after(aWord);
      currentNode = aWord;
    }
  });
}
```

---
## textNodesUnder.js

#### Description
- Extract text nodes in a DOM element
- Used for letter spacing

#### Exports
* textNodesUnder

#### Used by
* *includeLetterSpacer* from [includeLetterSpacer.js](#includeletterspacerjs)
* *wrapWords* from [wrapWords.js](#wrapwordsjs)

#### Code

*File:* [make/textNodesUnder.js](make/textNodesUnder.js)

*Cognitive Complexity:* 1

```js
export function textNodesUnder(el) {
  var n, a = [], walk = document.createTreeWalker(el, NodeFilter.SHOW_TEXT, null, false);
  while (n = walk.nextNode()) a.push(n);
  return a;
}
```

---
## getSpaceWidths.js

#### Description
- Get widhts of spaces needed fo letter-spacing adjustments

#### Exports
* getSpaceWidths

#### Uses
* *settings* from [__settings.js](#__settingsjs)
* *nonJustify* from [nonJustify.js](#nonjustifyjs)
* *reJustify* from [reJustify.js](#rejustifyjs)

#### Used by
* *adjustLetterSpacing* from [adjustLetterSpacing.js](#adjustletterspacingjs)
* *includeLetterSpacer* from [includeLetterSpacer.js](#includeletterspacerjs)

#### Code

*File:* [make/getSpaceWidths.js](make/getSpaceWidths.js)

*Cognitive Complexity:* 2

```js
export function getSpaceWidths() {
  let { hyphenateTags: parentSel } = settings;
  parentSel = parentSel.join(', ');
  let words = [...document.querySelectorAll('a-word')];
  let spaces = [...document.querySelectorAll('a-space')];
  // only keep one space per common parentNode and line
  let parentNodeMem = [];
  spaces = spaces.filter(el => {
    let pNode = el.closest(parentSel);
    let y = el.getBoundingClientRect().y;
    let keep = !parentNodeMem.find(([a, b]) => a === pNode && b === y);
    parentNodeMem.push([pNode, y]);
    return keep;
  });
  // check how stretched the spaces are
  nonJustify();
  spaces = spaces
    .map(el => ({ el, w: el.offsetWidth }))
    .filter(({ w }) => w);
  reJustify();
  spaces.forEach(x => x.w2 = x.el.offsetWidth);
  spaces = spaces
    .filter(({ w, w2 }) => w !== w2)
    .map(({ el, w, w2 }) => ({
      el,
      stretch: w2 / w,
      baseW: w,
      words: words.filter(x =>
        x.closest(parentSel) === el.closest(parentSel)
        && x.getBoundingClientRect().y === el.getBoundingClientRect().y
      )
    }));
  spaces.forEach(x => x.phrase = x.words.map(x => x.innerText)
    .join(' ').replace(/\s{1,}/g, ' '));
  return spaces;
}
```

---
## reJustify.js

#### Description
- Helper for space width calculation during letter spacing

#### Exports
* reJustify

#### Used by
* *getSpaceWidths* from [getSpaceWidths.js](#getspacewidthsjs)
* *includeLetterSpacer* from [includeLetterSpacer.js](#includeletterspacerjs)

#### Code

*File:* [make/reJustify.js](make/reJustify.js)

*Cognitive Complexity:* 0

```js
export function reJustify() {
  document.querySelector('style.non-justify').remove();
}
```

---
## nonJustify.js

#### Description
- Helper for space width calculation during letter spacing

#### Exports
* nonJustify

#### Used by
* *getSpaceWidths* from [getSpaceWidths.js](#getspacewidthsjs)
* *includeLetterSpacer* from [includeLetterSpacer.js](#includeletterspacerjs)

#### Code

*File:* [make/nonJustify.js](make/nonJustify.js)

*Cognitive Complexity:* 0

```js
export function nonJustify() {
  let head = document.querySelector('head');
  let style = document.createElement('style');
  style.classList.add('non-justify')
  style.innerHTML = '* {text-align: left !important;}';
  head.append(style);
}
```